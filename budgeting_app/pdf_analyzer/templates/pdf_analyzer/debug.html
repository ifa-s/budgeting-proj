<!DOCTYPE html>
<html>
<head>
    <title>PDF Debug Upload</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
        .result { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .error { background: #ffe6e6; border: 1px solid #ff9999; }
        .success { background: #e6ffe6; border: 1px solid #99ff99; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        button { padding: 10px 20px; margin: 10px 0; }
        #fileInfo { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>PDF Debug Upload Tool</h1>
    <p>This tool helps debug PDF processing issues step by step.</p>
    
    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" id="pdfFile" accept=".pdf" required>
        <br>
        <button type="submit">Test PDF Processing</button>
    </form>
    
    <div id="fileInfo"></div>
    <div id="result"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('pdfFile');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('result');
            const fileInfoDiv = document.getElementById('fileInfo');
            
            if (!file) {
                resultDiv.innerHTML = '<div class="result error">Please select a PDF file</div>';
                return;
            }
            
            // Show file info
            fileInfoDiv.innerHTML = `
                <div class="result">
                    <h3>File Info:</h3>
                    <p><strong>Name:</strong> ${file.name}</p>
                    <p><strong>Size:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                    <p><strong>Type:</strong> ${file.type}</p>
                </div>
            `;
            
            resultDiv.innerHTML = '<div class="result">Processing... Please wait.</div>';
            
            const formData = new FormData();
            formData.append('pdf_file', file);
            
            try {
                const response = await fetch('/pdf-analyzer/debug/upload/', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>✅ Processing Successful!</h3>
                            <p><strong>Text Length:</strong> ${result.text_length} characters</p>
                            <p><strong>Tables Found:</strong> ${result.num_tables}</p>
                            <p><strong>Transactions from Text:</strong> ${result.transactions_from_text || 'N/A'}</p>
                            <p><strong>Transactions from Tables:</strong> ${result.transactions_from_tables || 'N/A'}</p>
                            <details>
                                <summary>Text Preview (first 500 chars)</summary>
                                <pre>${result.text_preview}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>❌ Processing Failed</h3>
                            <p><strong>Error:</strong> ${result.error}</p>
                            <p><strong>Error Type:</strong> ${result.error_type}</p>
                            ${result.file_info ? `<pre>${JSON.stringify(result.file_info, null, 2)}</pre>` : ''}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ Network/Request Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>